<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Lector de códigos de barras y QR</title>
  </head>
  <body>
    <button onclick="scan()">Escanear</button>
    <br>
    <input type="text" id="resultado" readonly>
    <script src="https://cdn.jsdelivr.net/npm/quagga/dist/quagga.min.js"></script>
    <script>
      function scan() {
        navigator.mediaDevices.getUserMedia({
          audio: false,
          video: {
            facingMode: "environment"    // acceder a la cámara trasera del dispositivo
          }
        }).then(function(stream) {
          document.querySelector("#camera").srcObject = stream;    // mostrar la vista previa de la cámara en un elemento HTML
          Quagga.init({
            inputStream: {
              name: "Live",
              type: "LiveStream",
              target: document.querySelector("#camera")    // elemento HTML para mostrar la vista previa de la cámara
            },
            decoder: {
              readers: ["ean_reader", "qr_reader"]    // tipos de códigos a escanear
            }
          }, function(err) {
              if (err) {
                  console.log(err);
                  return;
              }
              Quagga.start();    // iniciar el escaneo
          });
          Quagga.onDetected(function(result) {
            document.getElementById("resultado").value = result.codeResult.code;
            Quagga.stop();    // detener el escaneo después de que se ha leído un código
          });
        }).catch(function(err) {
          console.log(err);
        });
        // detectar la posición del dispositivo
        window.addEventListener("deviceorientation", function(event) {
          var alpha = event.alpha;    // obtener el ángulo de la brújula
          if (alpha !== null) {
            if (alpha >= 45 && alpha <= 135) {
              // dispositivo en posición horizontal
              document.querySelector("#camera").style.transform
          = "rotate(90deg)";    // girar la vista previa de la cámara 90 grados
        } else {
          // dispositivo en posición vertical
          document.querySelector("#camera").style.transform = "rotate(0deg)";
        }
      }
    }, false);
  }
</script>
<style>
  #camera {
    width: 100%;
    height: auto;
    transform-origin: top left;
  }
</style>
<video id="camera"></video>
